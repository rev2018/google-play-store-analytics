import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import plotly.express as px

# Set wide layout
st.set_page_config(layout="wide")

# Title and styling
st.markdown("<h1 style='color: #6A1B9A; font-size: 48px;'>📊 Student Performance Analysis</h1>", unsafe_allow_html=True)
st.markdown("<h4 style='color: gray;'>A dashboard that allows you to explore marks, grades, and patterns in student data.</h4>", unsafe_allow_html=True)

# File uploader
uploaded_file = st.file_uploader("Upload your CSV file", type=["csv"])

if uploaded_file:
    df = pd.read_csv(uploaded_file)

    # Display the dataframe
    st.subheader("Dataset Preview 🧾")
    st.dataframe(df.head(), use_container_width=True)

    st.markdown("---")

    # Sidebar filters
    st.sidebar.header("Filters")
    selected_subject = st.sidebar.selectbox("Select Subject", df.columns[1:], index=0)

    # Grade distribution
    st.subheader(f"Grade Distribution for {selected_subject}")
    fig, ax = plt.subplots()
    df[selected_subject].hist(ax=ax, color='#7B1FA2', bins=10, edgecolor='black')
    ax.set_xlabel("Marks")
    ax.set_ylabel("Number of Students")
    ax.set_title(f"Distribution of Marks in {selected_subject}")
    st.pyplot(fig)

    # Interactive boxplot
    st.subheader(f"Boxplot for {selected_subject} ✏️")
    box_fig = px.box(df, y=selected_subject, points="all", color_discrete_sequence=["#BA68C8"])
    st.plotly_chart(box_fig, use_container_width=True)

    # Overall average marks per subject
    st.subheader("📈 Average Marks per Subject")
    avg_marks = df.iloc[:, 1:].mean().sort_values(ascending=False)
    avg_fig = px.bar(avg_marks, labels={'value': 'Average Marks', 'index': 'Subject'}, color=avg_marks.values,
                     color_continuous_scale='Purples')
    st.plotly_chart(avg_fig, use_container_width=True)

    # Correlation heatmap
    st.subheader("Correlation Matrix 🔥")
    corr_fig = px.imshow(df.iloc[:, 1:].corr(), text_auto=True, color_continuous_scale='RdBu_r')
    st.plotly_chart(corr_fig, use_container_width=True)

    st.markdown("---")
    st.markdown("Created with ❤️ by [Reva](https://www.linkedin.com/in/reva-bairwa)")
else:
    st.info("👈 Upload a CSV file to get started!")
